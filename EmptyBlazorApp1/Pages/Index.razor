@page "/"
@using EmptyBlazorApp1.Services
@using EmptyBlazorApp1.Components
@inject AccountService AccountService
@inject IDialogService DialogService

<MudAppBar Elevation="1" Bottom="true">
    <MudSpacer/>
    <MudIconButton Icon="@Icons.Material.Filled.CalendarToday" Color="currentPage == Pages.Calendar ? Color.Primary : Color.Default" OnClick="NavigateToCalendar"/>
    <MudSpacer/>
    <MudIconButton Icon="@Icons.Material.Filled.Dashboard" Color="currentPage == Pages.Communities ? Color.Primary : Color.Default" OnClick="NavigateToCommunities"/>
    <MudSpacer/>
    <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" Color="currentPage == Pages.Profile ? Color.Primary : Color.Default" OnClick="NavigateToLogined"/>
    <MudSpacer/>
</MudAppBar>

@switch (currentPage) {
    case Pages.Calendar:
        <CalendarComponent/>
        break;
    case Pages.Communities:
        <CommunitiesComponent/>
        break;
    case Pages.Login:
        <LoginComponent Callback="@_loginComponentCallback"/>
        break;
    case Pages.Profile:
        <ProfileComponent/>
        break;
}

@code {
    Action? _loginComponentCallback;

    enum Pages {
        Calendar,
        Communities,
        Login,
        Profile
    }

    void NavigateToCommunities() {
        Navigate(Pages.Communities);
    }

    void NavigateToCalendar() {
        Navigate(Pages.Calendar);
    }

    void NavigateToLogin() {
        var page = currentPage;
        _loginComponentCallback = () => Navigate(page);
        Navigate(Pages.Login);
    }

    void NavigateToLogined() {
        if (AccountService.IsAuthorized()) {
            Navigate(Pages.Profile);
        } else {
            var parameters = new DialogParameters<Dialog>();
            parameters.Add("ContentText", "Для просмотра этой страницы требуется регистрация");
            parameters.Add("ButtonText", "Регистрация");
            parameters.Add("Callback", () => NavigateToLogin());
            DialogService.Show<Dialog>("Требуется регистрация", parameters);
        }
    }

    Pages currentPage = Pages.Calendar;

    void Navigate(Pages page) {
        if (page == currentPage) {
            return;
        }
        currentPage = page;
        StateHasChanged();
    }
}